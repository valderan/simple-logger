# Архитектура Logger

## Общая концепция

Logger — это связка REST API и веб-клиента, которая помогает небольшим командам быстро собирать, хранить и анализировать логи микросервисов. API написано на Node.js/Express с MongoDB, интерфейс — на React и взаимодействует с API через защищённые эндпоинты.

## Структура репозитория

```text
simple-logger/
├── api/                   # Исходники и инфраструктура серверной части
│   ├── src/
│   │   ├── api/
│   │   │   ├── controllers/   # Бизнес-логика REST эндпоинтов
│   │   │   ├── middlewares/   # Авторизация, rate limiting, whitelist
│   │   │   ├── models/        # Mongoose-схемы
│   │   │   ├── routes/        # Определение маршрутов Express
│   │   │   └── utils/         # Mongo, фильтры, вспомогательные функции
│   │   ├── ping/              # Планировщик ping-проверок
│   │   └── telegram/          # Интеграция с Telegram Bot API
│   ├── docker-compose.*.yml   # Готовые сценарии запуска (dev/prod)
│   └── swaggerapi/            # Описание API в формате OpenAPI 3.0
├── client/                # Vite + React приложение для администраторов
│   ├── src/               # Страницы, компоненты и провайдеры контекста
│   └── docker-compose.yml # Сборка и запуск статики в Nginx
├── docs/                  # Документация (RU/EN) и примеры запросов
└── docs/examples/         # Готовые скрипты интеграции (bash, Go, Python, TS)
```

## Потоки данных

1. **Сбор логов** — сервисы интегрируются по UUID проекта и делают POST запросы на `/api/logs`. Контроллер `logController` валидирует запрос, сохраняет документ и фиксирует инциденты в `logger-system`, если структура некорректна.
2. **Управление проектами** — администратор авторизуется через `/api/auth/login`, а затем управляет проектами, ping-проверками и whitelist через защищённые эндпоинты `/api/projects/*` и `/api/settings/*`.
3. **Просмотр логов и метрик** — веб-клиент использует TanStack Query для обращения к API, кеширует ответы и отображает данные в таблицах и графиках. Фильтры логов прокидываются через query-параметры.
4. **Ping-мониторинг** — при добавлении сервиса создаётся запись в MongoDB, а воркер из `src/ping` периодически вызывает URL. Каждое падение фиксируется в `logger-system` и при активной интеграции отправляет уведомления в Telegram.

## Безопасность и эксплуатация

- **Rate limiting и whitelist.** Middleware из `src/api/middlewares` ограничивают количество запросов и проверяют IP-адреса.
- **Telegram-уведомления.** Модуль `src/telegram` отправляет сообщения пользователям, указанным в настройках проекта.
- **Docker-first.** Обе части проекта поставляются с Dockerfile и `docker-compose` конфигурациями для разработки и продакшена.
- **Swagger UI.** Спецификация OpenAPI лежит в `api/swaggerapi/openapi.yaml` и может быть запущена как отдельный сервис (`docker-compose.dev.yml`).

## Пользовательские сценарии

- **DevOps** подключает новый сервис: создаёт проект, выдаёт UUID разработчикам и настраивает whitelist.
- **Разработчик** отправляет логи через HTTP-клиент, пользуясь примерами из `docs/examples`.
- **Инженер поддержки** работает в веб-клиенте: фильтрует логи, следит за ping-сервисами и управляет уведомлениями.

Эти сценарии строятся поверх модульной архитектуры: бизнес-логика отделена от контроллеров, а фронтенд повторно использует провайдеры и хуки, что облегчает расширение продукта.
