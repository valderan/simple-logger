# Архитектура Logger

## Общая концепция

Logger — сервис централизованного сбора и анализа логов микросервисов. Приложение построено как набор REST API на Node.js/Express с базой данных MongoDB. Дополнительно поддерживается интеграция с Telegram и простой механизм мониторинга доступности HTTP-сервисов.

## Структура репозитория

```
/logger-project
├── src/                   # Исходный код TypeScript
│   ├── api/
│   │   ├── controllers/   # Бизнес-логика REST-эндпоинтов
│   │   ├── middlewares/   # Общие middleware (аутентификация, whitelist)
│   │   ├── models/        # Mongoose-схемы и типы
│   │   ├── routes/        # Определение маршрутов Express
│   │   └── utils/         # Вспомогательные утилиты (Mongo, фильтры)
│   ├── ping/              # Логика ping-мониторинга
│   ├── telegram/          # Клиент Telegram-бота
│   └── app.ts             # Точка входа приложения
├── test/                  # Тесты Jest
├── docker-compose.dev.yml # Пример запуска окружения разработчика
└── README.md
```

## Потоки данных

1. **Сбор логов** — микросервисы отправляют POST-запросы на `/api/logs`, передавая UUID проекта и полезную нагрузку лога. Сервис валидирует UUID, сохраняет документ и, при необходимости, отправляет уведомления.
2. **Работа с логами** — администратор авторизуется через `/api/auth/login`, получает токен и использует его для запросов на `/api/logs` и `/api/projects/:uuid/logs`. Фильтрация выполняется на стороне MongoDB.
3. **Ping-мониторинг** — при добавлении сервиса вызывается `/api/projects/:uuid/ping-services`. Сервис сохраняется и немедленно проверяется. При падении отправляется оповещение в Telegram.
4. **Безопасность** — запросы ограничиваются rate limiter-ом и проверкой белого списка IP (если он заполнен). Попытки входа с неверными учетными данными учитываются и приводят к блокировке IP.

## Пользовательские сценарии

- **DevOps** подключает новый проект: авторизуется, создает проект, получает UUID и конфигурацию формата логов.
- **Разработчик** подключает микросервис: использует выданный UUID и отправляет логи через REST API.
- **Дежурный инженер** мониторит состояние: открывает дашборд (в разработке), фильтрует логи, запускает ручную проверку ping-сервисов.

## Сетевые взаимодействия

- Внутри docker-compose все микросервисы могут стучаться без ограничений (access level `docker`).
- Для внешних подключений используется белый список IP.
- Telegram-бот требует переменной `BOT_API_KEY` и работает односторонне — только для отправки уведомлений.
