# Клиентское приложение Logger

В директории `./client` находится одностраничное приложение на React + TypeScript. Оно предоставляет веб-интерфейс для управления проектами логирования, просмотра логов и настройки уведомлений.

## Технологический стек

- **Vite** — сборщик и dev-сервер.
- **React Router** — маршрутизация между разделами.
- **MUI** — базовые UI-компоненты и тема со светлым/тёмным режимом.
- **TanStack Query** — кеширование и повторное использование запросов к API.
- **Axios** — HTTP-клиент.
- **Chart.js** — визуализация метрик на дашборде.

## Структура каталога

```text
client/
├── docker-compose.yml      # Сборка и запуск статики в контейнере Nginx
├── Dockerfile              # Продакшн-образ (Vite build + Nginx)
├── build-and-start-prod.sh # Скрипт сборки и запуска
├── package.json            # Скрипты и зависимости
└── src/
    ├── api/                # Функции работы с REST API
    ├── components/         # Повторно используемые UI-блоки
    ├── hooks/              # Кастомные хуки (авторизация, переводы)
    ├── localization/       # Текстовые ресурсы интерфейса
    ├── pages/              # Страницы, соответствующие разделам меню
    ├── providers/          # Провайдеры темизации, локализации и auth
    ├── theme.ts            # Темы MUI
    └── config.ts           # Конфигурация окружения и URL API
```

## Переменные окружения

Приложение использует переменные Vite (`VITE_*`), которые прокидываются через `.env` или флаги командной строки:

- `VITE_API_URL` — базовый URL REST API (например, `http://localhost:3000/api`).
- `LOGGER_VERSION` — строка с версией, отображается в футере.
- `LOGGER_PAGE_URL` — ссылка на страницу продукта.

При запуске через `docker-compose.yml` значения передаются как переменные окружения контейнера (`API_URL`, `LOGGER_VERSION`, `LOGGER_PAGE_URL`) и подставляются в фазе сборки.

## Основные разделы интерфейса

Маршруты описаны в `src/App.tsx` и доступны после авторизации:

1. **Dashboard** — обзор по проектам, активным ping-сервисам и последним логам. Использует диаграммы и карточки.
2. **Projects** — таблица проектов с поиском, быстрым переходом к логам и формами создания/редактирования (`AddProjectPage`, `EditProjectPage`).
3. **Ping services** — управление HTTP-проверками: создание, редактирование и удаление сервисов, запуск конкретной проверки или всех сервисов проекта, быстрый просмотр деталей (URL, теги, статус, временные метки) по клику на строку и фоновое обновление данных каждые две минуты при открытой странице.
4. **Logs** — мощный фильтр логов с сохранением состояния в URL, детальным просмотром, копированием JSON и пакетным удалением.
5. **Telegram** — управление пользователями бота, включение/отключение уведомлений и настройка тегов.
6. **Settings** — белый список IP, редактирование глобального rate limit с предупреждением и параметры безопасности. Изменения моментально отправляются на API.
7. **FAQ** — статическая справка и ссылки на документацию.

Отдельно доступна страница **Login**, которая реализует получение токена (`/api/auth/login`) и хранит данные в `AuthProvider`.

## Работа с API

Все запросы инкапсулированы в модуле `src/api`. Функции используют `axios` с базовым URL из `config.ts` и автоматически подставляют токен из `AuthContext`. Ключевые вызовы:

- `fetchProjects`, `createProject`, `updateProject`, `deleteProject` — CRUD для проектов.
- `filterLogs`, `deleteLogs`, `ingestLog` — получение и очистка логов.
- `createPingService`, `updatePingService`, `deletePingService`, `triggerPingCheck` — управление мониторингом и ручные проверки.
- `fetchRateLimitSettings`, `updateRateLimitSettings`, `fetchTelegramStatus`, `fetchTelegramBotUrl` — настройки безопасности и диагностика Telegram.
- `listWhitelist`, `addWhitelistIp`, `removeWhitelistIp` — настройки доступа.

TanStack Query обеспечивает кеширование данных и автоматическое обновление интерфейса после мутаций.

## Команды разработчика

```bash
cd client
npm install          # установка зависимостей
npm run dev          # запуск локального dev-сервера (http://localhost:5173)
npm run build        # production-сборка
npm run preview      # предпросмотр собранной версии
npm run lint         # проверка кода ESLint
```

Для запуска в Docker воспользуйтесь `docker-compose.yml`:

```bash
cd client
docker compose up --build
```

Контейнер соберёт статическую сборку и раздаст её через Nginx на порту `80`.

## UI- и UX-особенности

- Поддерживаются светлая и тёмная темы (`ThemeModeProvider`). Выбор сохраняется в `localStorage`.
- Переводы интерфейса находятся в `localization/translations.ts`; активный язык выбирается автоматически по браузеру.
- Состояние фильтров логов сохраняется в query-параметрах, что позволяет делиться ссылками.
- Компоненты таблиц используют `@mui/x-data-grid` для виртуализации и кастомных действий в строках.
- Страница Telegram показывает статус бота (подключён / нет токена) на основе `/api/settings/telegram-status` и ссылку из `/api/settings/telegram-url`, если она доступна.
- Раздел Ping services автоматически обновляет время последней проверки в фоне каждые две минуты, не превышая лимиты API.
- Таблица Ping services использует иконки вместо текстовых действий, а клик по строке открывает подробности с тегами и статусом сервиса.
- Изменение rate limit требует подтверждения и логируется в проект `logger-system` как предупреждение.

Эти принципы стоит учитывать при расширении приложения: новые страницы должны подключаться через `AppLayout`, работать с API через готовые хуки и поддерживать тему/локализацию.
