# Desktop-клиент Simple Logger

Этот документ описывает установку, конфигурацию и эксплуатацию десктопного клиента Simple Logger, построенного на базе Electron и использующего тот же веб-интерфейс, что и браузерная версия приложения.

## Возможности

- Единая кодовая база интерфейса: веб-сборка из каталога `client/dist` переиспользуется без доработок.
- Поддержка Windows, Linux и macOS через единый проект `./desktop`.
- Гибкая конфигурация путей к веб-сборке за счёт переменных окружения.
- Режим разработки поверх Vite dev-сервера и production-режим с локальными статическими файлами.

## Требования

- Node.js 18+
- npm 9+
- Собранный веб-клиент (команда `npm run build` в `./client`)
- Доступ к API (по умолчанию `http://localhost:3000`)

## Структура каталога `desktop`

| Элемент | Назначение |
| --- | --- |
| `main.js` | Основной процесс Electron: инициализация окна, загрузка веб-сборки, обработка ошибок. |
| `preload.js` | Безопасный слой между Electron и фронтендом. |
| `scripts/run-electron.js` | Запуск Electron с параметрами, удобными для разработки и продакшн-режима. |
| `scripts/sync-web-dist.js` | Копирование готовой веб-сборки в `web-dist`. |
| `web-dist/` | Каталог с production-сборкой веб-клиента. |
| `README.md`, `README_EN.md` | Руководства по сборке и запуску. |

## Подготовка веб-клиента

1. Перейдите в каталог `client` и установите зависимости: `npm install`.
2. Выполните `npm run build` — в каталоге `client/dist` появится production-сборка.
3. Скопируйте файлы в `desktop/web-dist` с помощью `npm run sync:web` внутри каталога `desktop`.

Скрипт `sync:web` принимает переменную `WEB_SOURCE_DIR`, что позволяет брать сборку из любого каталога (в том числе из CI-артефактов).

## Запуск десктопного клиента

### Production-режим с локальной сборкой

```bash
cd desktop
npm install
npm run sync:web  # при необходимости обновить web-dist
npm start
```

Electron загрузит `index.html` из `web-dist` (или из каталога, указанного в `WEB_DIST_DIR`).

### Режим разработки

```bash
# Терминал 1 — фронтенд
cd client
npm run dev

# Терминал 2 — Electron
cd desktop
npm install
npm run dev
```

По умолчанию десктопное приложение подключается к dev-серверу по адресу `http://localhost:5173`. Измените адрес через переменную `DEV_SERVER_URL`.

## Сборка установщиков

Electron Builder использует конфигурацию из `desktop/package.json` и поддерживает три целевые платформы:

- `npm run build:linux` — AppImage и deb-пакеты.
- `npm run build:win` — NSIS-установщик и portable-сборка.
- `npm run build:mac` — DMG и ZIP.

Команда `npm run build` собирает артефакты для текущей ОС. Все файлы сохраняются в `desktop/release`.

> macOS-пакеты следует собирать на macOS или в CI с поддержкой этой платформы.

## Настройка путей и окружения

- `WEB_SOURCE_DIR` — источник production-сборки для `npm run sync:web` (по умолчанию `../client/dist`).
- `WEB_DIST_DIR` — каталог, из которого Electron читает веб-файлы при запуске (по умолчанию `./web-dist`).
- `DEV_SERVER_URL` — адрес dev-сервера Vite для режима разработки.

## Обновление версии приложения

1. Соберите новую версию веб-клиента (`npm run build` в `client`).
2. Скопируйте файлы в `desktop/web-dist` (`npm run sync:web`).
3. Перезапустите десктоп-клиент или пересоберите установщик.

## Тестирование интерфейса

- Проверьте загрузку основных страниц (дашборд, логи, настройки) в русской и английской локализациях.
- Убедитесь, что таблицы и графики корректно масштабируются при изменении размера окна.
- В dev-режиме дополнительно проверьте работу с живым API (`http://localhost:3000`).

## Устранение неполадок

| Симптом | Решение |
| --- | --- |
| Пустое окно или ошибка `index.html` | Проверьте содержимое `web-dist` и корректность пути в `WEB_DIST_DIR`. |
| Dev-сервер не открывается | Убедитесь, что фронтенд запущен (`npm run dev` в `client`) и адрес указан верно. |
| Ошибка сборки в electron-builder | Убедитесь, что каталог `web-dist` не пуст и запуск происходит на поддерживаемой платформе. |

## Дополнительные материалы

- [README в каталоге desktop](../../desktop/README.md)
- [English README](../../desktop/README_EN.md)
- [Документация по API](../en/api.md) и существующие руководства в `docs/`
