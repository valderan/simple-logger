# Обзор и требования Logger

## Цели проекта

**Logger** — это безопасный сервис централизованного логирования для микросервисов. Он предназначен для небольших и средних команд, которым нужна единая точка сбора логов без развёртывания тяжёлых платформ наблюдаемости. Система обеспечивает приём событий, их хранение в MongoDB, фильтрацию, мониторинг доступности сервисов и оповещение через Telegram.

## Бизнес-требования

- Быстрое подключение сервисов через REST API и веб-интерфейс.
- Уведомления об инцидентах и падениях сервисов в Telegram.
- Поддержка ping-мониторинга с настраиваемым интервалом проверок.
- Защита API от спама и несанкционированного доступа (rate limiting, whitelist IP).
- Гибкая настройка лимитов запросов API без перезапуска сервиса.
- Возможность выгрузки, фильтрации и очистки логов по множеству параметров.

## Функциональные требования

### Веб-интерфейс

Веб-клиент из директории `client/` предоставляет следующие разделы:

1. **Авторизация** — вход по логину и паролю. После нескольких неверных попыток IP блокируется на час.
2. **Dashboard** — сводка по проектам, событиям и ping-сервисам.
3. **Projects** — управление проектами: создание, редактирование, удаление, получение UUID.
4. **Logs** — просмотр, фильтрация и удаление логов, копирование записей в буфер обмена.
5. **Ping services** — список проверок доступности, редактирование параметров, удаление и ручной запуск проверки.
6. **Telegram** — управление получателями уведомлений и настройками антиспама.
7. **Settings** — белый список IP, текущий rate limit и параметры безопасности API.

### База данных (MongoDB)

Основные коллекции:

- `projects` — метаданные проекта, формат логов, теги, настройки доступа, Telegram-уведомления, флаг `debugMode` и лимит хранения `maxLogEntries`.
- `logs` — события с уровнем, сообщением, тегами, метаданными (IP, сервис, пользователь, ID чата/пользователя Telegram, контекст по проекту, дополнительные поля).
- `pingservices` — URL для проверки, интервал, статус последней проверки, время проверки, теги уведомлений.
- `whitelists` — разрешённые IP и комментарии.

### API

- Аутентификация (`POST /api/auth/login`).
- CRUD для проектов и связанных ping-сервисов (`/api/projects/*`).
- Приём логов и их фильтрация (`/api/logs`).
- Управление белым списком IP и rate limit (`/api/settings/*`).

### Безопасность и аудит

- Системный проект `logger-system` создаётся автоматически, хранит внутренние события и принимает записи только от самой системы.
- Публичное API отклоняет попытки записать логи в `logger-system`.
- Подписаться на `logger-system` через команды Telegram (`ADD:<UUID>`) нельзя — управлять подписчиками может только сама система.
- Неверные UUID логируются как инциденты безопасности.
- Все попытки входа фиксируются с IP и временной меткой.
- Rate limiting и IP whitelist включены по умолчанию.

### Интеграция с Telegram

- Подключение бота через `BOT_API_KEY`.
- Управление списком получателей и тегами для уведомлений.
- Настройка антиспама: минимальный интервал между оповещениями.
- Управление подписками прямо из Telegram: команды `ADD:<UUID>`/`DELETE:<UUID>`, меню `/subscriptions`, `/info`, выбор языка `/language` и часовая блокировка после 10 неверных UUID. Все действия логируются в `logger-system`.【F:api/src/telegram/notifier.ts†L76-L370】【F:api/src/telegram/notifier.ts†L385-L399】
- Автоматически формируемые команды для подписки/отписки доступны в API и веб-клиенте для каждого проекта.【F:api/src/api/controllers/projectController.ts†L1-L267】
- При отключении уведомлений или удалении проекта все подписчики отписываются, получают уведомление и событие фиксируется в системном журнале.【F:api/src/api/controllers/projectController.ts†L124-L193】【F:api/src/telegram/notifier.ts†L249-L307】

## Пользовательские роли

- **DevOps / администратор** — создаёт проекты, настраивает whitelist, управляет ping-сервисами и уведомлениями.
- **Разработчик** — использует выданный UUID для отправки логов по HTTP, ориентируется на примеры из `docs/examples`.
- **Дежурный инженер** — работает в веб-интерфейсе, анализирует события, инициирует проверки, очищает логи.

## Документация и примеры

- `docs/ru/architecture.md` — устройство репозитория и поток данных.
- `docs/ru/database.md` — описание коллекций MongoDB.
- `docs/ru/api.md` и `docs/ru/logger_api_reference.md` — маршруты и примеры запросов.
- `docs/ru/client.md` — руководство по веб-клиенту.
- Каталог `docs/examples/` — готовые скрипты интеграции на Bash, Go, Python и TypeScript.

Эти документы поддерживают разработку, внедрение и сопровождение Logger, а также служат основой для англоязычной версии в `docs/en`.
