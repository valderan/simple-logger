# Simple Logger Desktop

Simple Logger Desktop — это Electron-оболочка для веб-клиента Simple Logger. Проект позволяет использовать один и тот же код интерфейса как в браузере, так и в десктопном приложении для Windows, Linux и macOS.

## Структура проекта

- `main.js` — основной процесс Electron, отвечающий за запуск окна приложения и загрузку фронтенда.
- `preload.js` — контекст для безопасного взаимодействия между веб-кодом и Electron.
- `scripts/` — вспомогательные скрипты для разработки и подготовки сборки.
- `web-dist/` — директория, из которой приложение читает собранный фронтенд. Поместите сюда файлы из `client/dist`.

## Требования

- Node.js 18 или новее
- npm 9+
- Собранный веб-клиент Simple Logger (`npm run build` в `./client`)

## Быстрый старт

1. Установите зависимости:

   ```bash
   cd desktop
   npm install
   ```

2. Соберите веб-клиент и скопируйте файлы в `web-dist`:

   ```bash
   cd ../client
   npm install
   npm run build
   cd ../desktop
   npm run sync:web
   ```

   Скрипт `sync:web` копирует содержимое `../client/dist` (или каталога из `WEB_SOURCE_DIR`) в `desktop/web-dist`.

3. Запустите приложение в production-режиме (используя локальную сборку):

   ```bash
   npm start
   ```

## Режим разработки

Для разработки удобно использовать dev-сервер Vite:

1. В одном терминале запустите фронтенд:

   ```bash
   cd ../client
   npm run dev
   ```

2. В другом терминале запустите Electron:

   ```bash
   cd desktop
   npm run dev
   ```

Скрипт `dev` автоматически подставит `DEV_SERVER_URL=http://localhost:5173`. При необходимости можно указать собственный URL:

```bash
DEV_SERVER_URL=http://localhost:4173 npm run dev
```

## Сборка приложений

Сборка выполняется через [`electron-builder`](https://www.electron.build/). Перед сборкой убедитесь, что каталог `web-dist` содержит актуальную версию фронтенда.

- Общая команда для всех платформ (создаст артефакты для текущей ОС):

  ```bash
  npm run build
  ```

- Целевые команды:

  ```bash
  npm run build:linux   # AppImage и deb
  npm run build:win     # NSIS-установщик и portable
  npm run build:mac     # DMG и ZIP
  ```

Результаты появятся в каталоге `desktop/release`.

> **Важно:** для сборки macOS пакетов требуется выполнение команды на macOS либо использование CI с поддержкой macOS.

## Пользовательские пути к сборке веб-клиента

Если готовая сборка фронтенда лежит в другом каталоге, задайте переменную окружения `WEB_SOURCE_DIR` перед запуском `npm run sync:web`. Пути могут быть относительными (относительно `desktop/`) или абсолютными.

```bash
WEB_SOURCE_DIR=../path/to/custom/dist npm run sync:web
```

Аналогично, при запуске приложения можно указать переменную `WEB_DIST_DIR`, чтобы Electron загрузил фронтенд из произвольной папки.

```bash
WEB_DIST_DIR=/opt/simple-logger/web npm start
```

## Обновление фронтенда

1. Соберите новую версию веб-клиента (`npm run build` в `./client`).
2. Скопируйте файлы в `desktop/web-dist` через `npm run sync:web`.
3. Пересоберите приложение при необходимости.

## Решение проблем

- **Окно пустое или отображается ошибка о `index.html`.** Проверьте, что каталог `web-dist` существует и содержит файлы, а также что переменная `WEB_DIST_DIR` указывает на корректный путь.
- **Dev-сервер не открывается.** Убедитесь, что `npm run dev` запущен в `client` и доступен по адресу, указанному в `DEV_SERVER_URL`.
- **Сборка macOS/Windows на Linux не запускается.** Electron Builder требует запуск на целевой платформе или использование CI с соответствующим окружением.

## Лицензия

Проект распространяется по лицензии MIT и наследует её от основного репозитория Simple Logger.
